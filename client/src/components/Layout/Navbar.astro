---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";

import NumberProduct from "../NumberProduct.astro";

const currentPath = Astro.url.pathname;
const numberProduct = 3;
---

<header>
  <nav class="block w-full px-4 mx-auto lg:px-8">
    <div class="flex items-center justify-between w-full">
      <!-- Enlaces y barra de bÃºsqueda en modo escritorio -->
      <ul class="hidden sm:flex items-center gap-9">
        <li class="inline-flex items-center gap-2">
          <a
            href="/"
            class={`flex items-center gap-2 relative group ${
              currentPath === "/"
                ? "text-white"
                : "text-gray-500 hover:text-white"
            }`}
          >
            <div class="relative flex items-center">
              <Icon
                name="retroController"
                class={`w-6 h-6 ${currentPath === "/" ? "text-white" : "text-gray-500 group-hover:text-white"}`}
              />
              <span
                class={`absolute bottom-[-12px] left-1/2 transform -translate-x-1/2 h-1.5 w-1.5 bg-white rounded-full transition-all duration-300 ease-in-out ${
                  currentPath === "/"
                    ? "opacity-100 scale-100"
                    : "opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100"
                }`}></span>
            </div>
            <span>Games</span>
          </a>
        </li>
        <li class="inline-flex items-center gap-2">
          <a
            href="/store"
            class={`flex items-center gap-2 relative group ${
              currentPath === "/store"
                ? "text-white"
                : "text-gray-500 hover:text-white"
            }`}
          >
            <div class="relative flex items-center">
              <Icon
                name="bagProducts"
                class={`w-6 h-6 ${currentPath === "/store" ? "text-white" : "text-gray-500 group-hover:text-white"}`}
              />
              <span
                class={`absolute bottom-[-12px] left-1/2 transform -translate-x-1/2 h-1.5 w-1.5 bg-white rounded-full transition-all duration-300 ease-in-out ${
                  currentPath === "/store"
                    ? "opacity-100 scale-100"
                    : "opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100"
                }`}></span>
            </div>
            <span>Store</span>
          </a>
        </li>
        <li
          id="searchBarContainerDesktop"
          class="flex items-center bg-zinc-900 rounded-full px-2.5 py-2 max-w-48 text-xs border-2 cursor-pointer border-zinc-950"
        >
          <Icon
            name="magnifyGlass"
            class="w-6 h-6 text-gray-400 pointer-events-none"
          />
          <input
            id="searchBarDesktop"
            type="search"
            name="searchGames"
            class="text-gray-400 placeholder-gray-400 focus:outline-none ml-2 w-full cursor-pointer"
            readonly
            placeholder="Search Games..."
          />
          <Icon
            name="settingsSearch"
            class="w-6 h-6 text-gray-400 pointer-events-none"
          />
        </li>
      </ul>

      <a href="/" class="flex justify-center mx-4 xl:mx-auto">
        <Image src="/favicon.svg" alt="Nintendo logo" width={40} height={40} />
      </a>

      <ul class="flex items-center gap-5">
        <li class="[&>li]:inline-flex [&>li]:items-center [&>li]:gap-2">
          <a href="/" class="flex items-center gap-2 relative">
            <Icon name="bagList" class="w-6 h-6" />
            <NumberProduct number={numberProduct} />
          </a>
        </li>
        <li>
          <a href="/" class="flex items-center gap-2 relative">
            <Icon name="heart" class="w-6 h-6" />
            <NumberProduct number={numberProduct} />
          </a>
        </li>
        <li class="ml-2 border-2 border-zinc-950 rounded-full">
          <a href="/" class="flex items-center relative">
            <Image
              src="https://yt3.ggpht.com/09AlR_MLxWgWp4842t535WEhtT_SQ7TstD1TeKDUO3m979R05vEQ_YGBrHO-eKDC3xJJj4cX=s88-c-k-c0x00ffffff-no-rj"
              width={36}
              height={36}
              alt="Your name"
              class="rounded-full"
            />
          </a>
        </li>
      </ul>
    </div>
    <div
      class="flex sm:hidden w-full justify-between items-center mt-4 pt-4 border-t border-gray-300"
    >
      <ul class="flex items-center gap-4 px-4">
        <li>
          <a
            href="/"
            class={`flex items-center gap-2 relative group ${
              currentPath === "/"
                ? "text-white"
                : "text-gray-500 hover:text-white"
            }`}
          >
            <div class="relative flex items-center">
              <span
                class={`transform -translate-x-1/2 h-1.5 w-1.5 bg-white rounded-full transition-all duration-300 ease-in-out ${
                  currentPath === "/"
                    ? "opacity-100 scale-100"
                    : "opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100"
                }`}></span>
            </div>
            <span>Games</span>
          </a>
        </li>
        <li>
          <a
            href="/store"
            class={`flex items-center gap-2 relative group ${
              currentPath === "/store"
                ? "text-white"
                : "text-gray-500 hover:text-white"
            }`}
          >
            <div class="relative flex items-center">
              <span
                class={`transform -translate-x-1/2 h-1.5 w-1.5 bg-white rounded-full transition-all duration-300 ease-in-out ${
                  currentPath === "/store"
                    ? "opacity-100 scale-100"
                    : "opacity-0 scale-0 group-hover:opacity-100 group-hover:scale-100"
                }`}></span>
            </div>
            <span>Store</span>
          </a>
        </li>
      </ul>

      <div
        id="searchBarContainerMobile"
        class="flex items-center bg-zinc-900 rounded-full px-2.5 py-2 text-xs border-2 cursor-pointer border-zinc-950"
      >
        <Icon
          name="magnifyGlass"
          class="w-6 h-6 text-gray-400 pointer-events-none"
        />
        <input
          id="searchBarMobile"
          type="search"
          name="searchGames"
          class="text-gray-400 placeholder-gray-400 focus:outline-none ml-2 w-full cursor-pointer"
          readonly
          placeholder="Search Games ..."
        />
        <Icon
          name="settingsSearch"
          class="w-6 h-6 text-gray-400 pointer-events-none"
        />
      </div>
    </div>
  </nav>
</header>

<div
  id="searchOverlay"
  class="hidden fixed inset-0 bg-zinc-900 bg-opacity-95 z-50 flex items-center justify-center"
>
  <div
    class="flex items-center w-3/4 lg:w-1/2 bg-zinc-800 p-4 rounded-lg relative bottom-1/3"
  >
    <Icon name="magnifyGlass" class="w-6 h-6 text-gray-400" />
    <input
      class="text-gray-400 placeholder-gray-400 focus:outline-none ml-2 w-full"
      type="search"
      placeholder="Search Games ..."
      name="searchGames"
      id="overlaySearch"
      autofocus
    />
    <button id="closeSearchOverlay" class="text-white text-lg ml-4">
      <Icon name="settingsSearch" class="w-6 h-6 text-gray-400" />
    </button>
  </div>
</div>

<script>
  const searchBarDesktop = document.getElementById("searchBarContainerDesktop");
  const searchBarMobile = document.getElementById("searchBarContainerMobile");
  const searchOverlay = document.getElementById("searchOverlay");
  const closeSearchOverlay = document.getElementById("closeSearchOverlay");
  const overlaySearchInput = document.getElementById("overlaySearch");

  searchBarDesktop.addEventListener("click", () => {
    searchOverlay.classList.remove("hidden");
    overlaySearchInput.focus();
  });

  searchBarMobile.addEventListener("click", () => {
    searchOverlay.classList.remove("hidden");
    overlaySearchInput.focus();
  });

  closeSearchOverlay.addEventListener("click", () => {
    searchOverlay.classList.add("hidden");
  });

  searchOverlay.addEventListener("click", (e) => {
    if (e.target === searchOverlay) {
      searchOverlay.classList.add("hidden");
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && !searchOverlay.classList.contains("hidden")) {
      searchOverlay.classList.add("hidden");
    }
  });
</script>
